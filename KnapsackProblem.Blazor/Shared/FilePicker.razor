@using Blazor.FileReader
@using Microsoft.AspNetCore.Components
@inject IFileReaderService fileReaderService

<input accept="@FileFormats" id="@_filePickerGuid" type="file" @ref=_element @onchange="ReadFile"
       multiple="@AllowMultiple"
       style="display: none" />

<input value="@Title" type="button" onclick="document.getElementById('@_filePickerGuid').click()" />

@code {
    [Parameter]
    public EventCallback<IEnumerable<IFileReference>> OnFilesSelected { get; set; }

    [Parameter]
    public string Title { get; set; }

    [Parameter]
    public bool AllowMultiple { get; set; } = false;

    [Parameter]
    public string FileFormats { get; set; } = "";

    private ElementReference _element;
    private Guid _filePickerGuid = Guid.NewGuid();

    private async Task ReadFile()
    {
        var reader = fileReaderService.CreateReference(_element);
        var files = await reader.EnumerateFilesAsync();
        await OnFilesSelected.InvokeAsync(files);
        await reader.ClearValue();
    }
}
