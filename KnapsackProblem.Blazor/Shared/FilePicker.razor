@using Blazor.FileReader
@using Microsoft.AspNetCore.Components
@inject IFileReaderService fileReaderService

@if (AllowMultiple)
{
    <input accept="@FileFormats" id="@FilePickerId" type="file" @ref=_element @onchange="ReadFile" multiple style="@PickerStyle" />
}
else
{
    <input accept="@FileFormats" id="@FilePickerId" type="file" @ref=_element @onchange="ReadFile" style="@PickerStyle" />
}
@if (!ShowSelectedFileName)
{
    <input value="@ButtonText" type="button" onclick="document.getElementById('@FilePickerId').click()" />
}

@code {
    [Parameter]
    public Func<IEnumerable<IFileReference>, Task> OnFilesSelected { get; set; }

    [Parameter]
    public string ButtonText { get; set; } = "Select";

    [Parameter]
    public bool AllowMultiple { get; set; } = false;

    [Parameter]
    public string FilePickerId { get; set; } = "filepicker";

    [Parameter]
    public bool ShowSelectedFileName { get; set; } = false;

    [Parameter]
    public string FileFormats { get; set; } = "";

    private string PickerStyle => ShowSelectedFileName ? "" : "display: none";

    private ElementReference _element;

    private async Task ReadFile()
    {
        var files = await fileReaderService.CreateReference(_element).EnumerateFilesAsync();
        await OnFilesSelected(files);
    }
}
