@using Blazor.FileReader
@using Microsoft.AspNetCore.Components
@inject IFileReaderService fileReaderService

<input accept="@FileFormats" id="@FilePickerId" type="file" @ref=_element @onchange="ReadFile"
       multiple="@AllowMultiple"
       style="@(ShowSelectedFileName ? "" : "display: none")" />

@if (!ShowSelectedFileName)
{
    <input value="@ButtonText" type="button" onclick="document.getElementById('@FilePickerId').click()" />
}

@code {
    [Parameter]
    public Func<IEnumerable<IFileReference>, Task> OnFilesSelected { get; set; }

    [Parameter]
    public string ButtonText { get; set; } = "Select";

    [Parameter]
    public bool AllowMultiple { get; set; } = false;

    [Parameter]
    public string FilePickerId { get; set; } = "filepicker";

    [Parameter]
    public bool ShowSelectedFileName { get; set; } = false;

    [Parameter]
    public string FileFormats { get; set; } = "";

    private ElementReference _element;

    private async Task ReadFile()
    {
        var files = await fileReaderService.CreateReference(_element).EnumerateFilesAsync();
        await OnFilesSelected(files);
    }
}
